<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<dom-module id="app-auth">
  <style>
    .hidden {
      display: none;
    }
  </style>
  <template>
    <firebase-auth id="auth" user="{{user}}" status-known="{{statusKnown}}"></firebase-auth>
    <div flex layout horizontal>
      <paper-button id="signinButton" on-tap="signIn">Войти</paper-button>
      <span id="credentials">{{user.displayName}} ({{user.email}})</span>
      <paper-button id="signoutButton" on-tap="signOut">Выйти</paper-button>
    </div>
  </template>

  <script>
    Polymer({
      is: 'app-auth',
      properties: {
        user: {
          type: Object,
          reflectToAttribute: true,
          notify: true,
        },
        statusKnown: {
          type: Boolean,
        },
      },
      observers: [
        '_autoAuth(user, statusKnown)',
      ],
      _autoAuth: function(user, statusKnown) {
        if (statusKnown) {
          if (!user) {
            this.$.signinButton.classList.remove("hidden");
            this.$.credentials.classList.add("hidden");
            this.$.signoutButton.classList.add("hidden");
          }
          else
          {
            this.$.signoutButton.classList.remove("hidden");
            this.$.credentials.classList.remove("hidden");
            this.$.signinButton.classList.add("hidden");
          }
        }
      },

      signIn: function() {
        console.log("Signing in");
        this.$.auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
      },
      signOut: function() {
        console.log("Signing out");
        this.$.auth.signOut();
      },
    });
  </script>
</dom-module>
